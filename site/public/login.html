<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Login</title>
  <link rel="stylesheet" href="css/header.css">
  <link rel="stylesheet" href="css/style.css">
  <link rel="stylesheet" href="css/footer.css" />
  <link rel="stylesheet" href="css/login.css" />
  <link rel="stylesheet" href="css/menu.css">
  <link rel="stylesheet" media="(min-width: 700px)" />


  <link rel="icon" href="images/icon.png">

  <script src="https://kit.fontawesome.com/89d28f01ec.js" crossorigin="anonymous"></script>
</head>

<body>
  <img src="images/logo.png" alt="" class="logo" id="main" />
  <div class="header" style="justify-content: center;
  display: flex;
  align-items: center;">
    <div class="container">
      <ul>
        <li><a href="index.html"> INÍCIO </a></li>
        <li><a href="index.html#busway"> PRODUTOS </a></li>
        <li><a href="helpdesk.html"> SUPORTE </a></li>
        <li><a href="index.html#about"> SOBRE NÓS </a></li>
        <li><a href="login.html"> LOGIN </a></li>
      </ul>
    </div>
  </div>

  <header id="header" style="height: 6rem;">
    <nav class="nav">
      <button class="toggle-menu">
        <span></span>
      </button>
    </nav>
  </header>

  <div id="menu" class="">
    <nav class="main-nav">
      <ul>
        <li>
          <a href="login.html">
            Login
          </a>
        </li>
        <li>
          <a href="index.html">
            Início
          </a>
        </li>
        <li>
          <a href="helpdesk.html">
            Suporte
          </a>
        </li>

        <li>
          <a href="contato.html">
            Contato
          </a>
        </li>
      </ul>
    </nav>
  </div>

  <div style="width: 100%; display: flex;align-items: center;margin-top: 8rem;justify-content: center;">

    <div class="logincaixa">
      <center>
        <h1>Login</h1>
      </center>
      <h3>Email:</h3>
      <center>
        <input type="text" id="ipt_email" placeholder="Digite seu email"><br>
      </center>
      <h3>Senha:</h3>
      <center>
        <input type="password" id="ipt_senha" placeholder="Digite sua senha">
      </center>
      <center>
        <div class="botao"><button onclick="validar_entrada()"><u>ENTRAR</u></button></div>
        <a href="perdiasenha.html" class="recSenha"><u>Recuperar senha</u></a>
      </center>
    </div>
  </div>

  <footer>
    <div class="paiFooter">
      <div class="redes">
        <h2>Redes Sociais</h2>
        <ul>
          <li>
            <a href="https://twitter.com" target="_blank">
              <i class="fa-brands fa-square-twitter fa-2xl"></i>Twitter
            </a>
          </li>
          <li>
            <a href="https://instagram.com" target="_blank">
              <i class="fa-brands fa-square-instagram fa-2xl"></i>Instagram
            </a>
          </li>
          <li>
            <a href="https://facebook.com" target="_blank">
              <i class="fa-brands fa-square-facebook fa-2xl"></i>Facebook
            </a>
          </li>
          <li>
            <a href="https://linkedin.com" target="_blank">
              <i class="fa-brands fa-linkedin fa-2xl"></i>Linkedin
            </a>
          </li>
        </ul>
      </div>

      <div class="acesso">
        <h2>Acesso Rápido</h2>
        <ul>
          <li><a href="index.html">Página Inicial</a></li>
          <li><a href="login.html">Login</a></li>
          <li><a href="cadastro.html">Cadastro</a></li>
          <li><a href="">Suporte</a></li>
        </ul>
      </div>

      <div class="contato">
        <h2 id="contato">Contato</h2>
        <ul>
          <li>
            <a href="https://api.whatsapp.com/send?phone=5511985618695" target="_blank">
              <i class="fa-brands fa-square-whatsapp fa-2xl"></i>(11) 98561-8695
            </a>
          </li>
          <li>
            <i class="fa-solid fa-square-phone fa-2xl"></i>(11) 5448-0817
          </li>
          <li>
            <a href="mailto:conway.enterprise@gmail.com" target="_blank">
              <i class="fa-solid fa-square-envelope fa-2xl"></i>conway.enterprise@gmail.com
            </a>
          </li>
          <li>
            <a href="https://www.google.com/maps/place/Rua+Haddock+Lobo,+595+-+Cerqueira+César,+São+Paulo+-+SP,+01414-001/@-23.5581662,-46.661538,17z/data=!3m1!4b1!4m6!3m5!1s0x94ce59d2a5270055:0x3c7ea4f4c7d51fb6!8m2!3d-23.5581662!4d-46.661538!16s%2Fg%2F11b8v86f6p"
              target="_blank">
              <i class="fa-solid fa-location-dot fa-2xl"></i>Rua Hadddock Lobo, 595 - São Paulo, SP
            </a>
          </li>
        </ul>
      </div>
    </div>
  </footer>

</body>

</html>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
<script>
  $('.toggle-menu').click(function () {
    $(this).toggleClass('active');
    $('#menu').toggleClass('open');
  });


  function validar_entrada() {

    const ax_email = ipt_email.value;
    const ax_senha = ipt_senha.value;

    var correcao_email01 = ax_email == "";
    var correcao_email02 = ax_email.indexOf('@') <= -1;
    var correcao_senha = ax_senha == "";

    if (correcao_email01) {
      alert("Favor inserir o e-mail correspondente a sua conta.")
    } else if (correcao_email02) {
      alert("Favor inserir o e-mail corretamente.")
    } else if (correcao_senha) {
      alert("Insira sua senha para ter acesso a sua conta.")
    } else {
      entrar()
    }
  }

  function entrar() {
    var emailVar = ipt_email.value;
    var senhaVar = ipt_senha.value;

    console.log("FORM LOGIN: ", emailVar);
    console.log("FORM SENHA: ", senhaVar);

    fetch("/usuarios/autenticar", {
      method: "POST",
      headers: {
        "Content-Type": "application/json"
      },
      body: JSON.stringify({
        emailServer: emailVar,
        senhaServer: senhaVar
      })
    }).then(function (resposta) {
      console.log("ESTOU NO THEN DO entrar()!");

      if (resposta.ok) {
        console.log(resposta);

        resposta.json().then(json => {
          console.log(json);
          console.log(JSON.stringify(json));

          sessionStorage.EMAIL_FUNCIONARIO = json.emailFunc;
          sessionStorage.NOME_FUNCIONARIO = json.nomeFunc;
          sessionStorage.CPF = json.cpfFunc;
          sessionStorage.ID_FUNCIONARIO = json.idFuncionario;
          sessionStorage.FK_REPRESENTANTE = json.fkRepresentante;
          sessionStorage.SENHA_FUNCIONARIO = json.senhaFunc;
          sessionStorage.FK_EMPRESA = json.idEmpresa;
          sessionStorage.NOME_EMPRESA = json.nomeEmpr;
          sessionStorage.RAMO_EMPRESA = json.ramoEmpr;
          sessionStorage.ADM_AIRWAY = json.adm;
          sessionStorage.ADM_EMPRESA = json.gerente;

          alert("Realizando Login")
          //alert(json.gerente)
          alert("Login realizado com sucesso")

          if (json.adm) {//se for trabalhador da airway
            window.location.href = "./cadastroInterno.html"
          } else {//se não

            if (json.ramoEmpr == "Tranporte de Onibus") {
              window.location.href = "./dashboardGeral.html";
            } else if (json.ramoEmpr == "Transporte Aéreo") {
              if(json.gerente == 'S'){
                window.location.href = "./dashboardAirWay/adm/dashboardAdm.html";
              }else{
                window.location.href = "./dashboardAirWay/dashboardFunc.html";
              }
            }
          }

        });
      } else {
        alert("Email ou senha incorretos")
        console.log("Houve um erro ao tentar realizar o login!");

        resposta.text().then(texto => {
          console.error(texto);
        });

      }
    }).catch(function (erro) {
      console.log(erro);
    });

    return false;
  }

  const header = document.querySelector(".header");
  window.addEventListener ("scroll", function() {
    header.classList.toggle ("sticky", window.scrollY > 100);
  });

</script>